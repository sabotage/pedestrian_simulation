<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedestrian Movement Simulation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app-container">
        <header>
            <div class="header-content">
                <h1>üö∂ Pedestrian Movement Simulation</h1>
                <p class="subtitle">Interactive Real-time Emergency Scenarios</p>
            </div>
        </header>

        <div class="main-content">
            <!-- Left Sidebar: Controls -->
            <aside class="sidebar left-sidebar">
                <section class="control-section">
                    <h3>üé¨ Preset Scenarios</h3>
                    <div class="input-group">
                        <label for="presetScenario">Select Scenario:</label>
                        <select id="presetScenario" class="styled-select" onchange="loadPresetScenario()">
                            <option value="">-- Choose a Scenario --</option>
                        </select>
                        <button onclick="loadPresetScenario()" class="btn btn-secondary">Load Scenario</button>
                    </div>
                    <div id="scenarioInfo" class="info-box" style="display:none;">
                        <p id="scenarioDescription"></p>
                        <p><strong>Recommended Pedestrians:</strong> <span id="scenarioRecommendedPeds"></span></p>
                    </div>
                </section>

                <section class="control-section">
                    <h3>üó∫Ô∏è Scene Setup</h3>
                    <div class="input-row">
                        <div class="input-group">
                            <label for="envWidth">Width (m):</label>
                            <input type="number" id="envWidth" value="50" min="10" max="200">
                        </div>
                        <div class="input-group">
                            <label for="envHeight">Height (m):</label>
                            <input type="number" id="envHeight" value="50" min="10" max="200">
                        </div>
                    </div>
                    <button onclick="createEnvironment()" class="btn btn-primary">Create Scene</button>
                </section>

                <section class="control-section">
                    <h3>üé® Drawing Tools</h3>
                    <div class="mode-selector">
                        <button onclick="setTool('wall')" id="btn-wall" class="mode-btn active">
                            üß± Wall
                        </button>
                        <button onclick="setTool('entrance')" id="btn-entrance" class="mode-btn">
                            üì• Entrance
                        </button>
                        <button onclick="setTool('exit')" id="btn-exit" class="mode-btn">
                            üì§ Exit
                        </button>
                        <button onclick="setTool('clear')" id="btn-clear" class="mode-btn">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </section>

                <section class="control-section">
                    <h3>üìç Entrance Settings</h3>
                    <div class="input-group">
                        <label for="flowRate">Flow Rate (peds/sec):</label>
                        <input type="number" id="flowRate" value="2.0" min="0.1" max="10" step="0.1" onchange="updateFlowRateDisplay()">
                    </div>
                    <div class="input-group">
                        <label for="entranceRadius">Radius (m):</label>
                        <input type="number" id="entranceRadius" value="1.0" min="0.5" max="5" step="0.5">
                    </div>
                </section>

                <section class="control-section">
                    <h3>‚öôÔ∏è Simulation Control</h3>
                    <div class="input-group">
                        <label for="numPedestrians">Total Pedestrians:</label>
                        <input type="number" id="numPedestrians" value="100" min="10" max="5000" step="10">
                    </div>
                    <div class="input-group">
                        <label for="initialPedestrians">Initial Pedestrians:</label>
                        <input type="number" id="initialPedestrians" value="0" min="0" max="1000" step="10" title="Number of pedestrians spawned immediately at scene start">
                    </div>
                    <div class="input-group">
                        <label for="simSpeed">Speed:</label>
                        <input type="number" id="simSpeed" value="10.0" min="0.1" max="50.0" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="exitMode">Exit Selection:</label>
                        <select id="exitMode" class="styled-select">
                            <option value="random">üé≤ Random</option>
                            <option value="weighted">‚öñÔ∏è Weighted</option>
                            <option value="nearest">üìç Nearest</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button onclick="startSimulation()" id="btn-start" class="btn btn-success">‚ñ∂Ô∏è Start</button>
                        <button onclick="stopSimulation()" id="btn-stop" class="btn btn-danger">‚è∏Ô∏è Stop</button>
                        <button onclick="resetSimulation()" id="btn-reset" class="btn btn-warning">üîÑ Reset</button>
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="recordSimulation">
                            <span>Record for Unity Export</span>
                        </label>
                    </div>
                </section>

                <section class="control-section">
                    <h3>‚ö° Emergency Events</h3>
                    <div class="input-group">
                        <label for="eventType">Event Type:</label>
                        <select id="eventType" class="styled-select" onchange="updateEventInputs()">
                            <option value="fire">üî• Fire</option>
                            <option value="shooting">üî´ Shooting</option>
                            <option value="entrance_blocked">üö´ Block Entrance</option>
                            <option value="exit_blocked">üö´ Block Exit</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="immediateEvent" checked>
                            <span>Trigger Immediately</span>
                        </label>
                    </div>
                    <div class="input-group" id="delayedEventTime" style="display: none;">
                        <label for="eventTime">Trigger Time (sec):</label>
                        <input type="number" id="eventTime" value="10" min="0" step="1">
                    </div>
                    <div id="eventPositionInputs">
                        <div class="event-hint">
                            üìç <strong>Click on map to select position</strong>
                        </div>
                        <div class="input-row">
                            <div class="input-group">
                                <label for="eventX">X Position:</label>
                                <input type="number" id="eventX" value="40" step="0.5" readonly>
                            </div>
                            <div class="input-group">
                                <label for="eventY">Y Position:</label>
                                <input type="number" id="eventY" value="40" step="0.5" readonly>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="eventRadius">Effect Radius (m):</label>
                            <input type="number" id="eventRadius" value="10" min="3" max="30" step="1">
                        </div>
                    </div>
                    <div id="eventIndexInputs" style="display: none;">
                        <div class="input-group">
                            <label for="eventIndex">Entrance/Exit Index:</label>
                            <input type="number" id="eventIndex" value="0" min="0">
                        </div>
                    </div>
                    <button onclick="addEvent()" class="btn btn-warning">‚ö° Add Event</button>
                    <div id="eventPreview" class="event-preview" style="display: none;">
                        <strong>Preview:</strong> <span id="eventPreviewText"></span>
                    </div>
                </section>

                <section class="control-section">
                    <h3>üíæ Export</h3>
                    <button onclick="exportToUnity()" class="btn btn-primary">üì¶ Export to Unity</button>
                </section>
            </aside>

            <!-- Center: Canvas -->
            <div class="canvas-area">
                <div class="toolbar">
                    <div class="canvas-info">
                        <span class="info-icon">‚ÑπÔ∏è</span>
                        <span class="info-text">Click to draw walls, place entrances/exits</span>
                    </div>
                </div>
                <div class="canvas-wrapper">
                    <canvas id="simulationCanvas" width="1200" height="800"></canvas>
                </div>
            </div>

            <!-- Right Sidebar: Statistics -->
            <aside class="sidebar right-sidebar">
                <section class="control-section">
                    <h3>üìä Real-time Statistics</h3>
                    <div class="stats-panel">
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-content">
                                <div class="stat-label">Time</div>
                                <div class="stat-value"><span id="stat-time">0.0</span>s</div>
                            </div>
                        </div>
                        <div class="stat-card active">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-content">
                                <div class="stat-label">Active</div>
                                <div class="stat-value" style="color: #10b981;"><span id="stat-active">0</span></div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ûï</div>
                            <div class="stat-content">
                                <div class="stat-label">Spawned</div>
                                <div class="stat-value" style="color: #3b82f6;"><span id="stat-spawned">0</span></div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-content">
                                <div class="stat-label">Exited</div>
                                <div class="stat-value" style="color: #8b5cf6;"><span id="stat-exited">0</span></div>
                            </div>
                        </div>
                        <div class="stat-card panic">
                            <div class="stat-icon">üò±</div>
                            <div class="stat-content">
                                <div class="stat-label">Avg Panic</div>
                                <div class="stat-value" style="color: #f59e0b;"><span id="stat-panic">0.0</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="control-section">
                    <h3>üé® Legend</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                            <span>Entrance</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></div>
                            <span>Exit</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #333;"></div>
                            <span>Wall</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                            <span>Normal Pedestrian</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);"></div>
                            <span>Panic Pedestrian</span>
                        </div>
                    </div>
                </section>
            </aside>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}?v=20251031Q"></script>
</body>
</html>
