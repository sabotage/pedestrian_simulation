# 十字路口场景布局 | Intersection Scenario Layout

## 场景概览 | Scenario Overview

**文件名**: `downtown_street.json`  
**尺寸**: 80m × 80m  
**类型**: 繁忙的城市十字路口 (Busy Urban Intersection)

---

## 地图布局 | Map Layout

```
                    北 North (40, 80)
                         ↑
                         │
                    Entrance 4
                         │
    ┌───────────────┬────┼────┬───────────────┐
    │               │    │    │               │
    │   办公楼 NE   │    │    │   商店 NW     │
    │   Office      │    │    │   Shop        │
    │   20×18m      │    │    │   15×15m      │
    │  Entrance 6   │    │    │  Entrance 5   │
    ├───────────────┤ ═══╬═══ ├───────────────┤
    │               ║    ┃    ║               │
    │               ║    ┃    ║               │
西 ─┼───Entrance 7──╬════╬════╬──Entrance 0──┼─ 东
West│               ║    ┃    ║               │East
    │               ║ 十 ┃ 字 ║               │
(0,40)             ║ 路 ┃ 口 ║            (80,40)
    │               ║ 口 ┃    ║               │
    │               ║    ┃    ║               │
    ├───────────────┤ ═══╬═══ ├───────────────┤
    │               │    │    │               │
    │   餐厅 SW     │    │    │   银行 SE     │
    │   Restaurant  │    │    │   Bank        │
    │   18×15m      │    │    │   20×20m      │
    │  Entrance 2   │    │    │  Entrance 3   │
    │               │    │    │               │
    └───────────────┴────┼────┴───────────────┘
                         │
                    Entrance 1
                         │
                         ↓
                    南 South (40, 0)

═══ = 人行横道 Crosswalk (Zebra Crossing)
║ = 南北道路 N-S Road
─ = 东西道路 E-W Road
□ = 建筑物 Buildings
```

---

## 详细元素 | Detailed Elements

### 中央交叉路口 | Central Intersection

**区域**: (25, 25) → (55, 55)  
**尺寸**: 30m × 30m  
**特点**: 开放空间，四个方向的人行横道

**人行横道位置** (Crosswalk Positions):
```
北侧: (35, 55) → (45, 55)  [10m长]
南侧: (35, 25) → (45, 25)  [10m长]
东侧: (55, 35) → (55, 45)  [10m长]
西侧: (25, 35) → (25, 45)  [10m长]
```

### 四个角落建筑 | Four Corner Buildings

#### 1. 西北 - 商店 (NW - Shop)
```
位置: (5, 60) → (20, 75)
尺寸: 15m × 15m
入口: Entrance 5 at (12, 67)
流量: 2.0 人/秒
用途: 零售商店，客流密集
```

#### 2. 东北 - 办公楼 (NE - Office)
```
位置: (60, 60) → (80, 78)
尺寸: 20m × 18m
入口: Entrance 6 at (70, 67)
流量: 1.5 人/秒
用途: 办公区域，早晚高峰
```

#### 3. 西南 - 餐厅 (SW - Restaurant)
```
位置: (5, 5) → (23, 20)
尺寸: 18m × 15m
入口: Entrance 2 at (14, 12)
流量: 2.5 人/秒
用途: 餐饮区域，午餐时段繁忙
```

#### 4. 东南 - 银行 (SE - Bank)
```
位置: (60, 5) → (80, 25)
尺寸: 20m × 20m
入口: Entrance 3 at (70, 15)
流量: 1.0 人/秒
用途: 金融服务，稳定客流
```

### 道路系统 | Road System

#### 北向道路 (North Road)
```
范围: X(35-45), Y(55-80)
宽度: 10m
连接: 中央路口 ↔ 北边界
入口: Entrance 4 at (40, 78)
出口: Exit 0 at (40, 78)
```

#### 南向道路 (South Road)
```
范围: X(35-45), Y(0-25)
宽度: 10m
连接: 南边界 ↔ 中央路口
入口: Entrance 1 at (40, 2)
出口: Exit 1 at (40, 2)
```

#### 东向道路 (East Road)
```
范围: X(55-80), Y(35-45)
宽度: 10m
连接: 中央路口 ↔ 东边界
入口: Entrance 0 at (78, 40)
出口: Exit 2 at (78, 40)
```

#### 西向道路 (West Road)
```
范围: X(0-25), Y(35-45)
宽度: 10m
连接: 西边界 ↔ 中央路口
入口: Entrance 7 at (2, 40)
出口: Exit 3 at (2, 40)
```

---

## 入口详情 | Entrance Details

| ID | 位置 (X, Y) | 类型 | 流量 (人/秒) | 半径 (m) |
|:--:|:-----------:|:----:|:------------:|:--------:|
| 0  | (78, 40)    | 东侧主干道 | 3.0 | 2.0 |
| 1  | (40, 2)     | 南侧主干道 | 3.0 | 2.0 |
| 2  | (14, 12)    | 西南餐厅 | 2.5 | 1.5 |
| 3  | (70, 15)    | 东南银行 | 1.0 | 1.5 |
| 4  | (40, 78)    | 北侧主干道 | 3.0 | 2.0 |
| 5  | (12, 67)    | 西北商店 | 2.0 | 1.5 |
| 6  | (70, 67)    | 东北办公楼 | 1.5 | 1.5 |
| 7  | (2, 40)     | 西侧主干道 | 3.0 | 2.0 |

**总流量**: ~19.0 人/秒

---

## 出口详情 | Exit Details

| ID | 位置 (X, Y) | 方向 | 半径 (m) |
|:--:|:-----------:|:----:|:--------:|
| 0  | (40, 78)    | 北   | 1.5 |
| 1  | (40, 2)     | 南   | 1.5 |
| 2  | (78, 40)    | 东   | 1.5 |
| 3  | (2, 40)     | 西   | 1.5 |

---

## 行人流动模式 | Pedestrian Flow Patterns

### 主要流向 | Main Flow Directions

**东西向流动** (E-W Flow):
```
Entrance 0 (东) → 中央路口 → Exit 3 (西)
Entrance 7 (西) → 中央路口 → Exit 2 (东)
流量: 6.0 人/秒
```

**南北向流动** (N-S Flow):
```
Entrance 4 (北) → 中央路口 → Exit 1 (南)
Entrance 1 (南) → 中央路口 → Exit 0 (北)
流量: 6.0 人/秒
```

**建筑出入流动** (Building Access):
```
Entrance 2,3,5,6 (建筑) → 中央路口 → Exits 0-3
流量: 7.0 人/秒
```

### 高峰时段场景 | Peak Hour Scenarios

**早高峰** (Morning Rush: 7:00-9:00):
- 办公楼入口（Entrance 6）流量 ↑
- 南北向主干道流量 ↑
- 推荐行人数: 1200-1500

**午餐时段** (Lunch: 11:30-13:00):
- 餐厅入口（Entrance 2）流量 ↑
- 商店入口（Entrance 5）流量 ↑
- 推荐行人数: 1000-1200

**晚高峰** (Evening Rush: 17:00-19:00):
- 所有主干道流量 ↑
- 银行入口（Entrance 3）流量 ↓
- 推荐行人数: 1500-2000

---

## 推荐测试场景 | Recommended Test Scenarios

### 场景1：正常通勤 (Normal Commute)

**参数**:
- 行人数量: 1000
- 速度: 1.0
- 无突发事件

**观察重点**:
- 人行横道处的行人聚集
- 四个方向的流量分配
- 建筑入口的排队情况

---

### 场景2：中央火灾 (Central Fire)

**参数**:
- 行人数量: 1200
- 突发事件: Fire at (40, 40)
- 半径: 15m
- 触发: 立即

**观察重点**:
- 行人避开中央区域
- 绕行路径选择
- 出口流量变化

---

### 场景3：商店枪击 (Shop Shooting)

**参数**:
- 行人数量: 800
- 突发事件: Shooting at (12, 67)
- 半径: 20m
- 触发: 20秒后

**观察重点**:
- 西北区域行人恐慌
- 疏散方向选择
- 其他区域行人反应

---

### 场景4：多事件协同 (Multiple Events)

**参数**:
- 行人数量: 1500
- 事件序列:
  1. T=10s: Fire at (40, 40), R=15m (立即)
  2. T=25s: Block Exit 2 (东侧出口)
  3. T=40s: Shooting at (70, 67), R=20m (定时)

**观察重点**:
- 连续事件下的行人应对
- 路径动态调整
- 疏散效率变化

---

## 性能指标 | Performance Metrics

### 推荐配置 | Recommended Settings

**低配置测试** (Low-end):
```
行人数量: 300-500
帧率目标: 60 FPS
用途: 快速验证、教学演示
```

**标准配置** (Standard):
```
行人数量: 800-1200
帧率目标: 30-60 FPS
用途: 一般研究、应急演练
```

**高配置测试** (High-end):
```
行人数量: 1500-2000
帧率目标: 30 FPS
用途: 压力测试、高峰场景
```

### 性能优化建议 | Performance Tips

✅ **减少墙壁数量**: 当前~60个，可优化到~40个  
✅ **降低模拟速度**: Speed=0.5可提高精度  
✅ **分批添加行人**: 避免一次性添加过多  
✅ **限制同时事件**: 最多3-5个事件同时存在

---

## 与其他场景对比 | Comparison with Other Scenarios

| 场景 | 尺寸 | 入口数 | 出口数 | 推荐行人 | 复杂度 |
|:-----|:----:|:------:|:------:|:--------:|:------:|
| **十字路口** | 80×80 | 8 | 4 | 1000 | ⭐⭐⭐⭐ |
| 大学校园 | 100×80 | 8 | 6 | 800 | ⭐⭐⭐⭐⭐ |
| 医院 | 80×60 | 6 | 4 | 500 | ⭐⭐⭐ |
| 购物中心 | 120×80 | 10 | 6 | 1500 | ⭐⭐⭐⭐⭐ |
| 城市公园 | 100×80 | 8 | 8 | 600 | ⭐⭐ |

**十字路口特点**:
- ✅ 中等复杂度，适合入门
- ✅ 四向流动模式清晰
- ✅ 建筑布局对称
- ✅ 适合突发事件测试

---

## 实际应用案例 | Real-world Applications

### 1. 交通规划

**用途**: 测试人行横道设计  
**方法**: 调整人行横道位置和宽度  
**指标**: 行人等待时间、通过效率

### 2. 应急演练

**用途**: 火灾疏散路径规划  
**方法**: 在不同位置触发火灾事件  
**指标**: 疏散时间、拥堵点分析

### 3. 商业分析

**用途**: 商店选址评估  
**方法**: 比较4个角落的行人流量  
**指标**: 潜在客流量、可达性

### 4. 安全评估

**用途**: 枪击事件响应分析  
**方法**: 测试不同位置的威胁影响  
**指标**: 疏散路径、安全区域

---

## 扩展建议 | Extension Ideas

### 可添加元素 | Potential Additions

- [ ] 交通信号灯控制
- [ ] 车辆流动模拟
- [ ] 天气影响（雨天减速）
- [ ] 时间段人流变化
- [ ] 建筑内部路径
- [ ] 地下通道
- [ ] 天桥系统
- [ ] 公交站点

### 高级功能 | Advanced Features

- [ ] 实时热力图显示
- [ ] 行人轨迹记录
- [ ] 流量统计报告
- [ ] AI路径优化建议
- [ ] VR第一人称视角
- [ ] 多场景对比分析

---

## 文件加载 | Loading the Scenario

### 方法1：Web界面加载

```
1. 启动: python -m src.web.app
2. 打开: http://localhost:5000
3. 点击: "Load Scenario"
4. 选择: scenarios/downtown_street.json
5. 点击: "Start Simulation"
```

### 方法2：Python代码加载

```python
from src.simulation.environment import Environment

# 加载场景
env = Environment.from_json('scenarios/downtown_street.json')

# 查看信息
print(f"地图尺寸: {env.width}x{env.height}")
print(f"入口数量: {len(env.entrances)}")
print(f"出口数量: {len(env.exits)}")
print(f"墙壁数量: {len(env.walls)}")
```

### 方法3：Unity导出

```
1. 在Web界面加载场景
2. 运行模拟
3. 点击: "Export Unity VR Scene"
4. 导入到Unity项目
5. 在VR中体验十字路口
```

---

**享受十字路口场景的模拟！**  
**Enjoy simulating the intersection scenario!**
