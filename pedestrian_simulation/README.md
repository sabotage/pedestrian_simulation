# è¡Œäººè¿åŠ¨æ¨¡æ‹Ÿç³»ç»Ÿ ğŸš¶â€â™‚ï¸ğŸš¶â€â™€ï¸

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è¡Œäººè¿åŠ¨ä»¿çœŸç³»ç»Ÿï¼ŒåŸºäº**ç¤¾ä¼šåŠ›æ¨¡å‹ï¼ˆSocial Force Modelï¼‰**ï¼Œæ”¯æŒWebå¯è§†åŒ–ç¼–è¾‘ã€å¤æ‚åœºæ™¯æ¨¡æ‹Ÿã€çªå‘äº‹ä»¶å¤„ç†ï¼Œå¹¶å¯æ— ç¼å¯¼å‡ºè‡³Unity VRåº”ç”¨ã€‚

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/Flask-2.0+-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. ğŸ¨ Webå¯è§†åŒ–ç¼–è¾‘å™¨
- **äº¤äº’å¼åœ°å›¾è®¾è®¡**ï¼šé€šè¿‡é¼ æ ‡ç»˜åˆ¶å¢™ä½“ã€éšœç¢ç‰©ã€å‡ºå…¥å£
- **å®æ—¶å‚æ•°è°ƒæ•´**ï¼šåŠ¨æ€è®¾ç½®è¡Œäººæ•°é‡ã€å¯†åº¦ã€é€Ÿåº¦ç­‰å‚æ•°
- **åœºæ™¯ä¿å­˜/åŠ è½½**ï¼šæ”¯æŒåœºæ™¯é…ç½®çš„ä¿å­˜å’Œå¤ç”¨

### 2. ğŸ§  é«˜çº§è¡Œäººæ¨¡å‹
- **ç¤¾ä¼šåŠ›æ¨¡å‹**ï¼šåŸºäºHelbingçš„ç»å…¸æ¨¡å‹ï¼Œæ¨¡æ‹ŸçœŸå®è¡Œäººè¡Œä¸º
- **å¤šçŠ¶æ€ç³»ç»Ÿ**ï¼šæ­£å¸¸ã€ææ…Œã€ç–æ•£ç­‰å¤šç§çŠ¶æ€
- **æ™ºèƒ½å¯¼èˆª**ï¼šè‡ªåŠ¨å¯»è·¯ã€é¿éšœã€ç›®æ ‡è·Ÿè¸ª

### 3. âš¡ çªå‘äº‹ä»¶æ¨¡æ‹Ÿ
æ”¯æŒå¤šç§çªå‘äº‹ä»¶ï¼š
- ğŸ”¥ **ç«ç¾**ï¼šè§¦å‘ææ…Œååº”å’Œç–æ•£è¡Œä¸º
- ğŸ”« **æªå‡»äº‹ä»¶**ï¼šæ¨¡æ‹Ÿæç«¯åº”æ€¥åœºæ™¯
- ğŸšª **å‡ºå…¥å£åŠ¨æ€å¼€é—­**ï¼šæµ‹è¯•ç–æ•£è·¯çº¿å˜åŒ–
- ğŸš§ **åŠ¨æ€éšœç¢ç‰©**ï¼šæ¨¡æ‹Ÿé€šé“å µå¡ç­‰æƒ…å†µ

### 4. ğŸ“Š æ•°æ®åˆ†æä¸å¯è§†åŒ–
- å®æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼ˆäººæ•°ã€é€Ÿåº¦ã€å¯†åº¦ç­‰ï¼‰
- å¯†åº¦çƒ­åŠ›å›¾
- è¡Œäººè½¨è¿¹å¯è§†åŒ–
- ç–æ•£æ—¶é—´åˆ†æ
- é«˜è´¨é‡åŠ¨ç”»å¯¼å‡º

### 5. ğŸ® Unity VRé›†æˆ
- å®Œæ•´çš„Unity C#åŠ è½½è„šæœ¬
- æ”¯æŒ3Dåœºæ™¯é‡ç°
- VRæ²‰æµ¸å¼ä½“éªŒ
- å®æ—¶å›æ”¾æ§åˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
pedestrian_simulation/
â”œâ”€â”€ core/                      # æ ¸å¿ƒä»¿çœŸå¼•æ“
â”‚   â””â”€â”€ pedestrian_model.py    # ç¤¾ä¼šåŠ›æ¨¡å‹å®ç°
â”œâ”€â”€ server/                    # WebæœåŠ¡å™¨
â”‚   â”œâ”€â”€ app.py                 # Flask APIæœåŠ¡
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ editor.html        # Webç¼–è¾‘å™¨ç•Œé¢
â”œâ”€â”€ visualization/             # å¯è§†åŒ–æ¨¡å—
â”‚   â””â”€â”€ visualizer.py          # MatplotlibåŠ¨ç”»ç”Ÿæˆ
â”œâ”€â”€ unity_integration/         # Unityé›†æˆ
â”‚   â””â”€â”€ SimulationDataLoader.cs # Unityæ•°æ®åŠ è½½è„šæœ¬
â”œâ”€â”€ scenarios/                 # ä¿å­˜çš„åœºæ™¯
â”œâ”€â”€ exports/                   # å¯¼å‡ºçš„æ•°æ®
â””â”€â”€ requirements.txt           # Pythonä¾èµ–
```

## ğŸ“¦ å®‰è£…æŒ‡å—

### ç³»ç»Ÿè¦æ±‚
- Python 3.8+
- ç°ä»£æµè§ˆå™¨ï¼ˆChrome/Firefox/Edgeæ¨èï¼‰
- Unity 2020.3+ (å¯é€‰ï¼Œç”¨äºVRå±•ç¤º)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†/ä¸‹è½½é¡¹ç›®**
```bash
cd pedestrian_simulation
```

2. **å®‰è£…Pythonä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **ï¼ˆå¯é€‰ï¼‰å®‰è£…FFmpegç”¨äºè§†é¢‘å¯¼å‡º**
```bash
# Ubuntu/Debian
sudo apt-get install ffmpeg

# macOS
brew install ffmpeg

# Windows: ä» https://ffmpeg.org/download.html ä¸‹è½½
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨Webç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰

1. **å¯åŠ¨WebæœåŠ¡å™¨**
```bash
cd server
python app.py
```

2. **æ‰“å¼€æµè§ˆå™¨**
è®¿é—®ï¼š`http://localhost:5000`

3. **åˆ›å»ºåœºæ™¯**
   - é€‰æ‹©"å¢™ä½“"æ¨¡å¼ï¼Œç»˜åˆ¶æˆ¿é—´è¾¹ç•Œï¼ˆåŒå‡»å®Œæˆç»˜åˆ¶ï¼‰
   - é€‰æ‹©"å‡ºå£"æ¨¡å¼ï¼Œç‚¹å‡»ä½ç½®æ·»åŠ å‡ºå…¥å£
   - é€‰æ‹©"ç”ŸæˆåŒº"æ¨¡å¼ï¼Œç»˜åˆ¶è¡Œäººç”ŸæˆåŒºåŸŸ
   - è®¾ç½®è¡Œäººæ•°é‡ç­‰å‚æ•°

4. **è¿è¡Œä»¿çœŸ**
   - ç‚¹å‡»"å¼€å§‹ä»¿çœŸ"æŒ‰é’®
   - è§‚å¯Ÿè¡Œäººè¿åŠ¨
   - å¯éšæ—¶ç‚¹å‡»"è§¦å‘äº‹ä»¶"æµ‹è¯•çªå‘æƒ…å†µ

5. **å¯¼å‡ºæ•°æ®**
   - ç‚¹å‡»"å¯¼å‡ºUnity"æŒ‰é’®
   - ä¸‹è½½JSONæ–‡ä»¶ç”¨äºUnity

### æ–¹å¼äºŒï¼šä½¿ç”¨Pythonè„šæœ¬

åˆ›å»º `run_simulation.py`ï¼š

```python
import numpy as np
from core.pedestrian_model import SimulationEnvironment, EventType
from visualization.visualizer import SimulationVisualizer

# åˆ›å»ºç¯å¢ƒ
env = SimulationEnvironment(width=40, height=40)

# æ·»åŠ å¢™ä½“ï¼ˆæˆ¿é—´è¾¹ç•Œï¼‰
room = np.array([[0, 0], [40, 0], [40, 40], [0, 40]])
env.add_obstacle(room)

# æ·»åŠ å†…éƒ¨éšœç¢ç‰©
obstacle = np.array([[15, 15], [25, 15], [25, 25], [15, 25]])
env.add_obstacle(obstacle)

# æ·»åŠ å‡ºå£
env.add_exit(np.array([20, 0]), width=3.0)
env.add_exit(np.array([40, 20]), width=3.0)

# ç”Ÿæˆ100ä¸ªè¡Œäºº
for _ in range(100):
    position = np.random.rand(2) * [40, 40]
    goal = env.exits[np.random.randint(len(env.exits))].position
    env.add_pedestrian(position, goal)

# åœ¨10ç§’æ—¶è§¦å‘ç«ç¾
def check_events():
    if env.time >= 10.0 and len(env.events) == 0:
        env.trigger_event(
            event_type=EventType.FIRE,
            position=np.array([20, 20]),
            radius=15.0,
            intensity=1.0
        )

# è¿è¡Œä»¿çœŸå¹¶å¯è§†åŒ–
visualizer = SimulationVisualizer(env)

# æ–¹å¼1: å®æ—¶æ˜¾ç¤º
visualizer.animate(duration=60.0)

# æ–¹å¼2: ä¿å­˜ä¸ºè§†é¢‘
# visualizer.animate(duration=60.0, save_path='simulation.mp4')

# å¯¼å‡ºUnityæ•°æ®
env.export_for_unity('exports/simulation_data.json')
```

è¿è¡Œï¼š
```bash
python run_simulation.py
```

## ğŸ® Unityé›†æˆè¯¦ç»†æ­¥éª¤

### 1. å‡†å¤‡Unityé¡¹ç›®

1. åˆ›å»ºæ–°çš„Unity 3Dé¡¹ç›®æˆ–ä½¿ç”¨ç°æœ‰VRé¡¹ç›®
2. åˆ›å»ºç©ºçš„GameObjectå‘½åä¸º"SimulationManager"
3. å°† `SimulationDataLoader.cs` è„šæœ¬é™„åŠ åˆ°è¯¥å¯¹è±¡

### 2. å¯¼å…¥ä»¿çœŸæ•°æ®

1. ä»Pythonç³»ç»Ÿå¯¼å‡ºæ•°æ®ï¼š
   - ä½¿ç”¨Webç•Œé¢çš„"å¯¼å‡ºUnity"æŒ‰é’®
   - æˆ–ä½¿ç”¨Pythonä»£ç ï¼š`env.export_for_unity('simulation_data.json')`

2. å°†JSONæ–‡ä»¶å¯¼å…¥Unityé¡¹ç›®ï¼š
   - æ‹–æ”¾JSONæ–‡ä»¶åˆ°Unityçš„Assetsæ–‡ä»¶å¤¹
   - Unityä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºTextAsset

### 3. é…ç½®è„šæœ¬

åœ¨Inspectorä¸­è®¾ç½®ï¼š
- **Simulation Data File**: æ‹–å…¥JSONæ–‡ä»¶
- **Pedestrian Prefab**: ï¼ˆå¯é€‰ï¼‰è‡ªå®šä¹‰è¡Œäººæ¨¡å‹
- **Wall Material**: å¢™ä½“æè´¨
- **Exit Marker Prefab**: ï¼ˆå¯é€‰ï¼‰å‡ºå£æ ‡è¯†æ¨¡å‹

### 4. è‡ªå®šä¹‰è¡Œäººé¢„åˆ¶ä½“ï¼ˆå¯é€‰ï¼‰

åˆ›å»ºæ›´çœŸå®çš„è¡Œäººæ¨¡å‹ï¼š

```csharp
// ç®€å•çš„åŠ¨ç”»æ§åˆ¶å™¨
public class PedestrianAnimator : MonoBehaviour
{
    private Animator animator;
    
    void Start()
    {
        animator = GetComponent<Animator>();
    }
    
    public void SetWalkSpeed(float speed)
    {
        if (animator != null)
        {
            animator.SetFloat("Speed", speed);
        }
    }
}
```

### 5. VRç›¸æœºè®¾ç½®

```csharp
// æ·»åŠ åˆ°VRç›¸æœº
public class SimulationController : MonoBehaviour
{
    private SimulationDataLoader loader;
    
    void Start()
    {
        loader = FindObjectOfType<SimulationDataLoader>();
    }
    
    void Update()
    {
        // ä½¿ç”¨VRæ§åˆ¶å™¨æŒ‰é’®æ§åˆ¶æ’­æ”¾
        if (OVRInput.GetDown(OVRInput.Button.One))
        {
            loader.Play();
        }
        
        if (OVRInput.GetDown(OVRInput.Button.Two))
        {
            loader.Pause();
        }
    }
}
```

## ğŸ“Š APIæ–‡æ¡£

### Web APIç«¯ç‚¹

#### 1. å¯åŠ¨ä»¿çœŸ
```http
POST /api/start_simulation
Content-Type: application/json

{
  "width": 50,
  "height": 50,
  "obstacles": [...],
  "exits": [...],
  "pedestrian_spawn": {
    "count": 100,
    "areas": [...]
  }
}
```

#### 2. è§¦å‘äº‹ä»¶
```http
POST /api/trigger_event
Content-Type: application/json

{
  "event_type": "fire",
  "position": [25, 25],
  "radius": 10,
  "intensity": 1.0
}
```

#### 3. è·å–å®æ—¶çŠ¶æ€
```http
GET /api/get_state

Response:
{
  "status": "success",
  "time": 15.3,
  "pedestrians": [...],
  "exits": [...],
  "statistics": {...}
}
```

#### 4. å¯¼å‡ºUnityæ•°æ®
```http
POST /api/export_unity

Returns: simulation_data.json file
```

### Python API

#### åŸºç¡€ä½¿ç”¨

```python
from core.pedestrian_model import SimulationEnvironment, EventType

# åˆ›å»ºç¯å¢ƒ
env = SimulationEnvironment(width=50, height=50)

# æ·»åŠ éšœç¢ç‰©
vertices = np.array([[x1, y1], [x2, y2], ...])
env.add_obstacle(vertices)

# æ·»åŠ å‡ºå£
env.add_exit(position=np.array([x, y]), width=2.0)

# æ·»åŠ è¡Œäºº
env.add_pedestrian(position=np.array([x, y]), goal=np.array([gx, gy]))

# è§¦å‘äº‹ä»¶
env.trigger_event(EventType.FIRE, position=np.array([x, y]), radius=10.0)

# æ‰§è¡Œä»¿çœŸæ­¥éª¤
for _ in range(1000):
    env.step()

# å¯¼å‡ºæ•°æ®
env.export_for_unity('output.json')
```

## ğŸ”¬ ç¤¾ä¼šåŠ›æ¨¡å‹è¯¦è§£

æœ¬ç³»ç»ŸåŸºäºHelbingçš„ç¤¾ä¼šåŠ›æ¨¡å‹ï¼Œè¡Œäººå—åˆ°ä»¥ä¸‹åŠ›çš„ä½œç”¨ï¼š

### 1. æœŸæœ›é€Ÿåº¦åŠ›
$$\vec{F}_i^{desired} = m_i \frac{\vec{v}_i^0 - \vec{v}_i}{\tau}$$

è¡Œäººè¯•å›¾ä»¥æœŸæœ›é€Ÿåº¦å‘ç›®æ ‡ç§»åŠ¨ã€‚

### 2. è¡Œäººé—´æ’æ–¥åŠ›
$$\vec{F}_{ij} = A \exp\left(\frac{r_{ij} - d_{ij}}{B}\right) \vec{n}_{ij}$$

æ¨¡æ‹Ÿä¸ªäººç©ºé—´å’Œé¿ç¢°è¡Œä¸ºã€‚

### 3. å¢™ä½“æ’æ–¥åŠ›
$$\vec{F}_{iW} = A_W \exp\left(\frac{r_i - d_{iW}}{B_W}\right) \vec{n}_{iW}$$

é˜²æ­¢è¡Œäººç©¿å¢™ã€‚

### 4. èº«ä½“æ¥è§¦åŠ›
å½“è¡Œäººå‘ç”Ÿç‰©ç†æ¥è§¦æ—¶ï¼š
$$\vec{F}_{ij}^{body} = k(r_{ij} - d_{ij})\vec{n}_{ij} + \kappa(r_{ij} - d_{ij})\Delta v_{ji}^t \vec{t}_{ij}$$

## ğŸ“ˆ åº”ç”¨åœºæ™¯

1. **å»ºç­‘è®¾è®¡**
   - è¯„ä¼°ç–æ•£è·¯çº¿
   - ä¼˜åŒ–å‡ºå…¥å£ä½ç½®
   - æµ‹è¯•äººæµæ‰¿è½½èƒ½åŠ›

2. **åº”æ€¥ç®¡ç†**
   - ç¾éš¾ç–æ•£æ¼”ç»ƒ
   - åº”æ€¥å“åº”è§„åˆ’
   - é£é™©è¯„ä¼°

3. **åŸå¸‚è§„åˆ’**
   - å…¬å…±ç©ºé—´è®¾è®¡
   - äººè¡Œé“å®½åº¦è§„åˆ’
   - äº¤é€šæ¢çº½ä¼˜åŒ–

4. **æ•™è‚²åŸ¹è®­**
   - VRå®‰å…¨åŸ¹è®­
   - è¡Œä¸ºå­¦ç ”ç©¶
   - ä»¿çœŸæ•™å­¦

5. **æ´»åŠ¨ç®¡ç†**
   - å¤§å‹æ´»åŠ¨äººæµæ§åˆ¶
   - åœºé¦†å®¹é‡æµ‹è¯•
   - å®‰ä¿è§„åˆ’

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è¡Œäººå‚æ•°

```python
from core.pedestrian_model import Pedestrian

# åˆ›å»ºè‡ªå®šä¹‰è¡Œäºº
ped = Pedestrian(
    id=0,
    position=np.array([10, 10]),
    velocity=np.zeros(2),
    goal=np.array([40, 40]),
    radius=0.3,           # åŠå¾„
    mass=70.0,            # è´¨é‡
    desired_speed=1.34,   # æœŸæœ›é€Ÿåº¦
    max_speed=2.0         # æœ€å¤§é€Ÿåº¦
)
```

### è°ƒæ•´æ¨¡å‹å‚æ•°

```python
# ä¿®æ”¹ç¤¾ä¼šåŠ›æ¨¡å‹å‚æ•°
env.model.A = 2000      # æ’æ–¥åŠ›å¼ºåº¦
env.model.B = 0.08      # æ’æ–¥åŠ›èŒƒå›´
env.model.tau = 0.5     # æ”¾æ¾æ—¶é—´
```

### æ‰¹é‡åœºæ™¯æµ‹è¯•

```python
def run_batch_simulation(scenarios):
    results = []
    for scenario in scenarios:
        env = create_environment(scenario)
        env = run_simulation(env, duration=60)
        results.append(analyze_results(env))
    return results
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: Webç•Œé¢æ— æ³•è¿æ¥**
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :5000

# æ›´æ”¹ç«¯å£
python app.py --port 8080
```

**Q: è¡Œäººè¡Œä¸ºå¼‚å¸¸**
- æ£€æŸ¥å¢™ä½“æ˜¯å¦é—­åˆ
- ç¡®è®¤å‡ºå£ä½ç½®å¯è¾¾
- è°ƒæ•´ç¤¾ä¼šåŠ›æ¨¡å‹å‚æ•°

**Q: UnityåŠ è½½å¤±è´¥**
- ç¡®è®¤JSONæ ¼å¼æ­£ç¡®
- æ£€æŸ¥Unity Consoleé”™è¯¯ä¿¡æ¯
- éªŒè¯æ•°æ®è·¯å¾„

**Q: åŠ¨ç”»ç”Ÿæˆå¤±è´¥**
```bash
# å®‰è£…FFmpeg
pip install ffmpeg-python
```

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Helbing, D., & MolnÃ¡r, P. (1995). Social force model for pedestrian dynamics. Physical Review E, 51(5), 4282.

2. Helbing, D., Farkas, I., & Vicsek, T. (2000). Simulating dynamical features of escape panic. Nature, 407(6803), 487-490.

3. MoussaÃ¯d, M., Helbing, D., & Theraulaz, G. (2011). How simple rules determine pedestrian behavior and crowd disasters. Proceedings of the National Academy of Sciences, 108(17), 6884-6888.

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ‘¥ ä½œè€…

- åˆå§‹å¼€å‘ï¼šClaude & User
- ç»´æŠ¤è€…ï¼š[Your Name]

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢Dirk Helbingæ•™æˆçš„å¼€åˆ›æ€§å·¥ä½œ
- æ„Ÿè°¢å¼€æºç¤¾åŒºçš„æ”¯æŒ

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µï¼š[GitHub Repository]
- é—®é¢˜åé¦ˆï¼š[Issues]
- é‚®ç®±ï¼šyour.email@example.com

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼
